<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="Content-Security-Policy" content="default-src 'none'; img-src {{cspSource}} https: data:; style-src {{cspSource}} 'unsafe-inline'; script-src 'nonce-{{nonce}}';">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Huge AI Chat</title>
  <link rel="stylesheet" href="{{styleUri}}">
</head>
<body>
  <div class="app">
    <header class="topbar">
      <div class="left-actions">
        <button
          id="newThreadBtn"
          class="btn icon-btn"
          aria-label="新聊天"
          title="新聊天"
          data-tooltip="新聊天"
        >✎</button>
      </div>
      <div class="right-actions">
        <button
          id="statusToggleBtn"
          class="btn icon-btn status-toggle status-idle"
          aria-label="状态详情"
          aria-pressed="false"
          title="状态详情（点击展开）"
          data-tooltip="状态详情（点击展开）"
        >
          <span class="status-toggle-dot" aria-hidden="true"></span>
        </button>
        <button
          id="openBrowserBtn"
          class="btn icon-btn"
          aria-label="浏览器查看"
          title="浏览器查看"
          data-tooltip="浏览器查看"
        >↗</button>
        <button
          id="historyBtn"
          class="btn icon-btn"
          aria-haspopup="dialog"
          aria-expanded="false"
          aria-label="历史记录"
          title="历史记录"
          data-tooltip="历史记录"
        >↺</button>
        <button
          id="copyThreadBtn"
          class="btn icon-btn"
          aria-label="复制会话"
          title="复制会话"
          data-tooltip="复制会话"
        >⧉</button>
        <button
          id="exportThreadBtn"
          class="btn icon-btn"
          aria-label="导出 Markdown"
          title="导出 Markdown"
          data-tooltip="导出 Markdown"
        >⤓</button>
        <button
          id="clearHistoryBtn"
          class="btn icon-btn danger"
          aria-label="清空历史"
          title="清空历史"
          data-tooltip="清空历史"
        >⌫</button>
      </div>
    </header>

    <main class="content">
      <section class="chat">
        <div id="historyBackdrop" class="history-backdrop hidden"></div>
        <div id="historyPanel" class="history-panel hidden" role="dialog" aria-label="History">
          <div class="history-head">
            <div class="history-title">History</div>
            <button id="historyCloseBtn" class="history-close" type="button" aria-label="Close history">×</button>
          </div>
          <div class="history-search-wrap">
            <input id="historySearchInput" type="text" placeholder="搜索历史记录..." />
          </div>
          <ul id="threadList" class="thread-list history-list"></ul>
        </div>

        <div id="authBanner" class="auth-banner hidden">
          <span id="authText"></span>
          <div class="auth-actions">
            <button id="runSetupBtn" class="btn">Run Setup</button>
            <button id="retryBtn" class="btn primary">Retry</button>
          </div>
        </div>

        <div id="statusBar" class="status-bar status-idle hidden" role="status" aria-live="polite">
          <div class="status-head">
            <span id="statusDot" class="status-dot" aria-hidden="true"></span>
            <span id="statusTitle" class="status-title">系统就绪</span>
            <span id="statusTime" class="status-time"></span>
          </div>
          <div id="statusDetail" class="status-detail">等待你的提问。</div>
          <div id="statusSuggestion" class="status-suggestion">输入问题后按 Enter 发送。</div>
        </div>

        <div id="messages" class="messages"></div>

        <div id="imagePreview" class="image-preview hidden" role="dialog" aria-modal="true" aria-label="图片预览">
          <div id="imagePreviewBackdrop" class="image-preview-backdrop"></div>
          <div class="image-preview-panel">
            <div class="image-preview-toolbar">
              <button id="imageDownloadBtn" type="button" class="mini-btn">下载图片</button>
              <button id="imagePreviewCloseBtn" type="button" class="mini-btn">关闭</button>
            </div>
            <div class="image-preview-content">
              <img id="imagePreviewImg" src="" alt="preview" />
            </div>
          </div>
        </div>

        <div class="composer">
          <div id="attachmentBar" class="attachment-bar hidden">
            <div class="attachment-head">
              <span id="attachmentSummary"></span>
              <button id="clearAttachmentsBtn" type="button" class="mini-btn">清除图片</button>
            </div>
            <div id="attachmentList" class="attachment-list"></div>
          </div>
          <div id="slashMenu" class="slash-menu hidden" role="listbox" aria-label="斜杠命令">
          </div>
          <div id="followUpBar" class="follow-up-bar hidden">
            <span class="follow-up-icon">↩</span>
            <span id="followUpText" class="follow-up-text"></span>
          </div>
          <div class="composer-box">
            <textarea id="input" placeholder="输入问题，Enter 发送，Shift+Enter 换行（输入 / 查看命令）"></textarea>
            <div class="composer-toolbar">
              <div class="composer-toolbar-left">
                <button id="attachImageBtn" class="composer-tool-btn" type="button" aria-label="添加图片" title="添加图片">
                  <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor"><path d="M14.5 2.5h-13A.5.5 0 0 0 1 3v10a.5.5 0 0 0 .5.5h13a.5.5 0 0 0 .5-.5V3a.5.5 0 0 0-.5-.5zM2 12.5v-1.88l2.72-2.72a.25.25 0 0 1 .35 0L7.78 10.6l-1.13 1.13a.75.75 0 0 0 1.06 1.06l3.57-3.57a.25.25 0 0 1 .35 0L14 11.59V12.5H2zm12-3.83-1.97-1.97a1.75 1.75 0 0 0-2.47 0L7.78 8.47 5.42 6.1a1.75 1.75 0 0 0-2.47 0L2 7.05V4h12v4.67zM5.5 6a1 1 0 1 0 0-2 1 1 0 0 0 0 2z"/></svg>
                </button>
                <button id="drawImageBtn" class="composer-tool-btn" type="button" aria-label="Google 画图" title="Google AI 画图">
                  <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor"><path d="M11.7 1.3a1 1 0 0 1 1.4 0l1.6 1.6a1 1 0 0 1 0 1.4l-8 8a1 1 0 0 1-.4.2l-3.5 1a.5.5 0 0 1-.6-.6l1-3.5a1 1 0 0 1 .2-.4l8-8zM12.4 2L11 3.4 12.6 5l1.4-1.4L12.4 2zM11.5 6.1L9.9 4.5l-6.5 6.5-.7 2.3 2.3-.7 6.5-6.5z"/></svg>
                </button>
                <button id="fastDrawBtn" class="composer-tool-btn" type="button" aria-label="Grok 极速画图" title="Grok 极速画图">
                  <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor"><path d="M9.5 1L3 9h4.5L6 15l7-8H8.5L11 1H9.5z"/></svg>
                </button>
                <button id="slashCmdBtn" class="composer-tool-btn" type="button" aria-label="命令菜单" title="命令菜单">
                  <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor"><path d="M5.56 14L10.44 2h1l-4.88 12h-1z"/></svg>
                </button>
              </div>
              <div class="composer-toolbar-right">
                <button id="sendBtn" class="composer-send-btn" type="button" aria-label="发送" title="发送" disabled>
                  <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor"><path d="M.989 14.666L15.67 8.353a.4.4 0 0 0 0-.706L.989 1.334a.4.4 0 0 0-.566.442L1.97 7.5H8.5a.5.5 0 0 1 0 1H1.97L.423 14.224a.4.4 0 0 0 .566.442z"/></svg>
                </button>
              </div>
            </div>
          </div>
        </div>
      </section>
    </main>
  </div>
  <script nonce="{{nonce}}" src="{{scriptUri}}"></script>
</body>
</html>
